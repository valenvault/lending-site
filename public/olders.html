<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    body.dark { background-color: #121212; color: #eee; }
    body.dark .card { background-color: #1e1e1e; color: #eee; }
    body.dark .table { color: #eee; }
    .theme-toggle { position: fixed; top: 12px; left: 12px; }
  </style>
</head>
<body>
  <button id="toggleTheme" class="btn btn-outline-secondary theme-toggle">ğŸŒ™ Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©/Ø±ÙˆØ´Ù†</button>

  <div class="container mt-4">
    <h1 class="mb-4">Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</h1>
    <div id="ordersTable" class="table-responsive"></div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©/Ø±ÙˆØ´Ù†
    const themeKey = 'preferred-theme';
    const savedTheme = localStorage.getItem(themeKey);
    if (savedTheme === 'dark') document.body.classList.add('dark');
    document.getElementById('toggleTheme').addEventListener('click', () => {
      document.body.classList.toggle('dark');
      localStorage.setItem(themeKey, document.body.classList.contains('dark') ? 'dark' : 'light');
    });

    // Ú¯Ø±ÙØªÙ† Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ Ø§Ø² Ø³Ø±ÙˆØ±
    async function loadOrders() {
      try {
        const r = await fetch('/api/orders');
        const orders = await r.json();
        if (!orders.length) {
          document.getElementById('ordersTable').innerHTML = '<div class="alert alert-info">Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
          return;
        }
        let html = `
          <table class="table table-bordered table-striped">
            <thead class="table-dark">
              <tr>
                <th>Ø´Ù†Ø§Ø³Ù‡</th>
                <th>Ù†Ø§Ù…</th>
                <th>Ú©ÛŒÙ Ù¾ÙˆÙ„</th>
                <th>Ù…Ø¨Ù„Øº</th>
                <th>Ù†ÙˆØ¹ ÙˆØ«ÛŒÙ‚Ù‡</th>
                <th>Ø§Ø±Ø²Ø´ ÙˆØ«ÛŒÙ‚Ù‡</th>
                <th>Ù…Ø¯Øª (Ù…Ø§Ù‡)</th>
                <th>Ø¨Ù‡Ø±Ù‡ (%)</th>
                <th>Ú©Ø§Ø±Ù…Ø²Ø¯</th>
                <th>Ù…Ø¬Ù…ÙˆØ¹</th>
                <th>ØªØ§Ø±ÛŒØ®</th>
              </tr>
            </thead>
            <tbody>
        `;
        for (const o of orders) {
          html += `
            <tr>
              <td>${o.id}</td>
              <td>${o.name}</td>
              <td>${o.wallet}</td>
              <td>${o.amount}</td>
              <td>${o.collateralType}</td>
              <td>${o.collateralValue}</td>
              <td>${o.duration}</td>
              <td>${o.interest}</td>
              <td>${o.feeAmount}</td>
              <td>${o.total}</td>
              <td>${new Date(o.date).toLocaleString('fa-IR')}</td>
            </tr>
          `;
        }
        html += '</tbody></table>';
        document.getElementById('ordersTable').innerHTML = html;
      } catch (err) {
        document.getElementById('ordersTable').innerHTML = '<div class="alert alert-danger">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</div>';
      }
    }

    loadOrders();
  </script>
</body>
</html>
