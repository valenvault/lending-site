<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>سامانه وام‌دهی</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">

  <style>
    body { font-family: Vazir, sans-serif; background-color: #f8f9fa; color: #222; }
    body.dark { background-color: #000; color: #f0f0f0; }

    .card { border-radius: 10px; }
    body.dark .card { background-color: #1c1c1c; border-color: #444; }
    body.dark .card-body { background-color: #1c1c1c; color: #f0f0f0; }
    body.dark .card-header { background-color: #333 !important; color: #fff !important; }

    /* جدول سفارشات */
    #ordersTable th, #ordersTable td { color: #000; }
    body.dark #ordersTable { background-color: #1c1c1c !important; border-color: #444 !important; }
    body.dark #ordersTable thead { background-color: #333 !important; }
    body.dark #ordersTable tbody tr { background-color: #222 !important; }
    body.dark #ordersTable tbody tr:hover { background-color: #2a2a2a !important; }
    body.dark #ordersTable th, body.dark #ordersTable td {
      border-color: #444 !important;
      color: #f0f0f0 !important;
      background-color: inherit !important;
    }

    .form-control { background-color: #fff; color: #000; }
    body.dark .form-control { background-color: #222; color: #f0f0f0; border: 1px solid #555; }

    .is-invalid { border: 2px solid #dc3545 !important; background-color: #fff0f0 !important; }
    body.dark .is-invalid { border: 2px solid #ff6b6b !important; background-color: #330000 !important; color: #fff !important; }

    .text-success { color: #28a745 !important; font-weight: bold; }
  </style>
</head>
<body class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 id="mainTitle" class="m-0">سامانه وام‌دهی</h5>
    <div class="d-flex gap-2">
      <button id="toggleMode" class="btn btn-outline-secondary">تغییر حالت تاریک/روشن</button>
      <button id="systemMode" class="btn btn-outline-primary">همگام با سیستم</button>
      <button id="langToggle" class="btn btn-secondary">English</button>
    </div>
  </div>

  <!-- Borrower -->
  <div class="card shadow mb-4">
    <div id="borrowerHeader" class="card-header bg-primary text-white">وام‌گیرنده</div>
    <div class="card-body">
      <form id="borrowerForm" class="row g-3">
        <div class="col-md-6"><label class="form-label">نام</label><input type="text" name="name" class="form-control" placeholder="مثال: علی رضایی"></div>
        <div class="col-md-6"><label class="form-label">آدرس کیف پول</label><input type="text" name="wallet" class="form-control" placeholder="مثال: EQC..."></div>
        <div class="col-md-6"><label class="form-label">مبلغ وام</label><input type="number" name="amount" class="form-control" placeholder="مثال: 1000"></div>
        <div class="col-md-6"><label class="form-label">مدت وام (ماه)</label><input type="number" name="duration" class="form-control" placeholder="مثال: 6"></div>
        <div class="col-12"><button type="submit" class="btn btn-primary">ثبت درخواست وام</button></div>
      </form>
      <div id="borrowerResult" class="mt-3"></div>
    </div>
  </div>

  <!-- Lender -->
  <div class="card shadow mb-4">
    <div id="lenderHeader" class="card-header bg-success text-white">وام‌دهنده</div>
    <div class="card-body">
      <form id="lenderForm" class="row g-3">
        <div class="col-md-6"><label class="form-label">نام</label><input type="text" name="name" class="form-control" placeholder="مثال: محمد کریمی"></div>
        <div class="col-md-6"><label class="form-label">آدرس کیف پول</label><input type="text" name="wallet" class="form-control" placeholder="مثال: EQC..."></div>
        <div class="col-md-6"><label class="form-label">مبلغ</label><input type="number" name="amount" class="form-control" placeholder="مثال: 5000"></div>
        <div class="col-md-6"><label class="form-label">مدت (ماه)</label><input type="number" name="duration" class="form-control" placeholder="مثال: 12"></div>
        <div class="col-md-6"><label class="form-label">بهره (%)</label><input type="number" name="interest" class="form-control" placeholder="مثال: 10"></div>
        <div class="col-12"><button type="submit" class="btn btn-success">ثبت پیشنهاد وام</button></div>
      </form>
      <div id="lenderResult" class="mt-3"></div>
    </div>
  </div>

  <!-- Orders Table -->
  <div class="card shadow mb-4">
    <div id="ordersHeader" class="card-header bg-dark text-white">لیست سفارشات</div>
    <div class="card-body">
      <div class="table-responsive">
        <table id="ordersTable" class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>نوع</th><th>نام</th><th>کیف پول</th><th>مبلغ</th><th>مدت (ماه)</th><th>بهره (%)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    function markEmptyFields(form) {
      const inputs = form.querySelectorAll("input, select, textarea");
      let allFilled = true;
      inputs.forEach(input => {
        const value = (input.value || "").trim();
        if (!value) { input.classList.add("is-invalid"); allFilled = false; }
        else { input.classList.remove("is-invalid"); }
      });
      return allFilled;
    }

    function handleSubmit(formId, resultId, typeLabelFa, typeLabelEn) {
      const form = document.getElementById(formId);
      const resultBox = document.getElementById(resultId);
      const allFilled = markEmptyFields(form);
      if (!allFilled) { resultBox.innerHTML = ""; return; }

      const langBtn = document.getElementById("langToggle");
      const isFa = langBtn.innerText === "English";
      resultBox.innerHTML = isFa
        ? '<div class="text-success">سفارش شما با موفقیت ثبت شد ✅</div>'
        : '<div class="text-success">Your order has been submitted successfully ✅</div>';

      const data = Object.fromEntries(new FormData(form).entries());
      const tbody = document.querySelector("#ordersTable tbody");
      const row = tbody.insertRow();
      const typeLabel = isFa ? typeLabelFa : typeLabelEn;

      row.innerHTML = `
        <td>${typeLabel}</td>
        <td>${data.name || "-"}</td>
        <td>${data.wallet || "-"}</td>
        <td>${data.amount || "-"}</td>
        <td>${data.duration || "-"}</td>
        <td>${data.interest || (formId === "borrowerForm" ? "" : "-")}</td>
      `;

      form.reset();
    }

    function setupForm(formId, resultId, typeLabelFa, typeLabelEn) {
      const form = document.getElementById(formId);
      form.addEventListener("input", () => markEmptyFields(form));
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        handleSubmit(formId, resultId, typeLabelFa, typeLabelEn);
      });
    }

    function updateOrdersTableLanguage(isEnglish) {
      const headers = document.querySelectorAll("#ordersTable thead th");
      if (isEnglish) {
        headers[0].innerText = "Type";
        headers[1].innerText = "Name";
        headers[2].innerText = "Wallet";
        headers[3].innerText = "Amount";
        headers[4].innerText = "Duration (Months)";
        headers[5].innerText = "Interest (%)";
      } else {
        headers[0].innerText = "نوع";
        headers[1].innerText = "نام";
        headers[2].innerText = "کیف پول";
        headers[3].innerText = "مبلغ";
        headers[4].innerText = "مدت (ماه)";
        headers[5].innerText = "بهره (%)";
      }

      // تغییر ردیف‌های قبلی
      document.querySelectorAll("#ordersTable tbody tr").forEach(row => {
        const typeCell = row.cells[0];
        if (isEnglish) {
          if (typeCell.innerText === "وام‌گیرنده") typeCell.innerText = "Borrower";
          if (typeCell.innerText === "وام‌دهنده") typeCell.innerText = "Lender";
        } else {
          if (typeCell.innerText === "Borrower") typeCell.innerText = "وام‌گیرنده";
          if (typeCell.innerText === "Lender") typeCell.innerText = "وام‌دهنده";
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      // دکمه تاریک/روشن
      document.getElementById("toggleMode").addEventListener("click", () => {
        document.body.classList.toggle("dark");
      });

      // دکمه همگام با سیستم
      document.getElementById("systemMode").addEventListener("click", () => {
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          document.body.classList.add("dark");
        } else {
          document.body.classList.remove("dark");
        }
      });

      // تغییر زبان
      document.getElementById("langToggle").addEventListener("click", () => {
        const langBtn = document.getElementById("langToggle");
        const mainTitle = document.getElementById("mainTitle");

        const borrowerLabels = document.querySelectorAll("#borrowerForm .form-label");
        const borrowerInputs = document.querySelectorAll("#borrowerForm .form-control");

        const lenderLabels = document.querySelectorAll("#lenderForm .form-label");
        const lenderInputs = document.querySelectorAll("#lenderForm .form-control");

        const switchingToEnglish = (langBtn.innerText === "English");

        if (switchingToEnglish) {
          langBtn.innerText = "فارسی";
          mainTitle.innerText = "Loan System";

          document.getElementById("borrowerHeader").innerText = "Borrower";
          document.getElementById("lenderHeader").innerText = "Lender";
          document.getElementById("ordersHeader").innerText = "Orders List";

          document.querySelector("#borrowerForm button").innerText = "Submit Loan Request";
          document.querySelector("#lenderForm button").innerText = "Submit Loan Offer";

          borrowerLabels[0].innerText = "Name";
          borrowerLabels[1].innerText = "Wallet address";
          borrowerLabels[2].innerText = "Loan Amount";
          borrowerLabels[3].innerText = "Loan Duration (Months)";
          borrowerInputs[0].placeholder = "e.g. Ali Rezaei";
          borrowerInputs[1].placeholder = "e.g. EQC...";
          borrowerInputs[2].placeholder = "e.g. 1000";
          borrowerInputs[3].placeholder = "e.g. 6";

          lenderLabels[0].innerText = "Name";
          lenderLabels[1].innerText = "Wallet address";
          lenderLabels[2].innerText = "Amount";
          lenderLabels[3].innerText = "Duration (Months)";
          lenderLabels[4].innerText = "Interest (%)";
          lenderInputs[0].placeholder = "e.g. Mohammad Karimi";
          lenderInputs[1].placeholder = "e.g. EQC...";
          lenderInputs[2].placeholder = "e.g. 5000";
          lenderInputs[3].placeholder = "e.g. 12";
          lenderInputs[4].placeholder = "e.g. 10";

          updateOrdersTableLanguage(true);

        } else {
          langBtn.innerText = "English";
          mainTitle.innerText = "سامانه وام‌دهی";

          document.getElementById("borrowerHeader").innerText = "وام‌گیرنده";
          document.getElementById("lenderHeader").innerText = "وام‌دهنده";
          document.getElementById("ordersHeader").innerText = "لیست سفارشات";

          document.querySelector("#borrowerForm button").innerText = "ثبت درخواست وام";
          document.querySelector("#lenderForm button").innerText = "ثبت پیشنهاد وام";

          borrowerLabels[0].innerText = "نام";
          borrowerLabels[1].innerText = "آدرس کیف پول";
          borrowerLabels[2].innerText = "مبلغ وام";
          borrowerLabels[3].innerText = "مدت وام (ماه)";
          borrowerInputs[0].placeholder = "مثال: علی رضایی";
          borrowerInputs[1].placeholder = "مثال: EQC...";
          borrowerInputs[2].placeholder = "مثال: 1000";
          borrowerInputs[3].placeholder = "مثال: 6";

          lenderLabels[0].innerText = "نام";
          lenderLabels[1].innerText = "آدرس کیف پول";
          lenderLabels[2].innerText = "مبلغ";
          lenderLabels[3].innerText = "مدت (ماه)";
          lenderLabels[4].innerText = "بهره (%)";
          lenderInputs[0].placeholder = "مثال: محمد کریمی";
          lenderInputs[1].placeholder = "مثال: EQC...";
          lenderInputs[2].placeholder = "مثال: 5000";
          lenderInputs[3].placeholder = "مثال: 12";
          lenderInputs[4].placeholder = "مثال: 10";

          updateOrdersTableLanguage(false);
        }
      });

      // اتصال فرم‌ها
      setupForm("borrowerForm", "borrowerResult", "وام‌گیرنده", "Borrower");
      setupForm("lenderForm", "lenderResult", "وام‌دهنده", "Lender");
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
